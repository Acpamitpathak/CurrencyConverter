import os
from dotenv import load_dotenv
from semantic_kernel import Kernel
from semantic_kernel.connectors.ai.open_ai import AzureChatCompletion

load_dotenv()

def setup_kernel():
    kernel = Kernel()

    azure_chat = AzureChatCompletion(
        deployment_name=os.getenv("AZURE_OPENAI_CHAT_DEPLOYMENT_NAME"),
        endpoint=os.getenv("AZURE_OPENAI_ENDPOINT"),
        api_key=os.getenv("AZURE_OPENAI_API_KEY"),
        api_version=os.getenv("AZURE_OPENAI_API_VERSION"),
        service_id="azure-gpt",
        max_tokens=2048,
        temperature=0.3,
        top_p=0.9
    )

    kernel.add_service(azure_chat)
    kernel.set_default_chat_service("azure-gpt")
    return kernel


# After assembling final_prompt...
chat = self.kernel.get_service(type=type(azure_chat))
result = await chat.complete_chat(prompt=final_prompt)