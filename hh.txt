import os
import json
from datetime import datetime

# Save response as markdown file
def save_json_as_markdown(data: dict, output_dir: str = "output") -> str:
    os.makedirs(output_dir, exist_ok=True)
    filename = f"evaluation_{datetime.now().strftime('%Y%m%d_%H%M%S')}.md"
    filepath = os.path.join(output_dir, filename)

    with open(filepath, "w", encoding="utf-8") as f:
        f.write("# âœ… LLM Evaluation Output\n\n")
        f.write("```json\n")
        f.write(json.dumps(data, indent=2))
        f.write("\n```")

    return filepath


result = await asyncio.wait_for(
    component.invoke_async(final_prompt),
    timeout=240
)

response_data = result.json()
markdown_path = save_json_as_markdown(response_data)

return JSONResponse(content={
    "message": "LLM response completed",
    "markdown_file": markdown_path,
    "preview": response_data
})